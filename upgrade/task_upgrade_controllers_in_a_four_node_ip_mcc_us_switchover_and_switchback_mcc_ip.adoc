---
permalink: upgrade/task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html 
sidebar: sidebar 
keywords: metrocluster, upgrade, controller, ip, configuration, switchover, switchback, workflow, nodes, tiebreaker, verify, bootrage, root, aggregate, disks 
summary: 'ONTAP 9.8부터 MetroCluster 스위치오버 운영을 사용하여 클라이언트에 무중단 서비스를 제공하는 동시에 파트너 클러스터의 컨트롤러 모듈을 업그레이드할 수 있습니다. 이 절차의 일부로 다른 구성 요소(예: 스토리지 쉘프 또는 스위치)를 업그레이드할 수 없습니다.' 
---
= 스위치오버 및 스위치백을 사용하여 MetroCluster IP 구성에서 컨트롤러 업그레이드(ONTAP 9.8 이상)
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.8부터 MetroCluster 스위치오버 운영을 사용하여 클라이언트에 무중단 서비스를 제공하는 동시에 파트너 클러스터의 컨트롤러 모듈을 업그레이드할 수 있습니다. 이 절차의 일부로 다른 구성 요소(예: 스토리지 쉘프 또는 스위치)를 업그레이드할 수 없습니다.

.이 작업에 대해
* 플랫폼은 ONTAP 9.8 이상을 실행해야 합니다.
* 이 절차는 MetroCluster IP 구성의 컨트롤러 모듈에 적용됩니다.
* 지원되는 업그레이드 경로는 원래 플랫폼 모델에 따라 다릅니다.
+
내부 쉘프가 있는 플랫폼 모델은 지원되지 않습니다.

+
|===


| 더 빠르고 확실하게 구축 | 새로운 플랫폼 모델 


 a| 
** AFF A320

 a| 
** AFF A400




 a| 
** FAS8200

 a| 
** FAS9000
** FAS8300
** FAS8700


|===



NOTE: BES-53248 IP 스위치를 사용하는 경우 AFF A320 플랫폼 모델은 업그레이드가 지원되지 않습니다.

* 구성의 모든 컨트롤러는 동일한 유지보수 기간 동안 업그레이드해야 합니다.
+
이 유지 관리 활동 외부에서는 컨트롤러 유형이 서로 다른 MetroCluster 구성을 작동하는 것이 지원되지 않습니다.

* 새 플랫폼은 원래 플랫폼과 다른 모델이어야 합니다.
* IP 스위치는 지원되는 펌웨어 버전을 실행하고 있어야 합니다.
* 새 플랫폼의 슬롯이 원래 시스템보다 적거나 포트 유형이 적거나 다른 경우 새 시스템에 어댑터를 추가해야 할 수 있습니다.
+
자세한 내용은 를 참조하십시오 https://hwu.netapp.com/["NetApp Hardware Universe를 참조하십시오"].

* 새 플랫폼에서는 원래 플랫폼의 IP 주소, 넷마스크 및 게이트웨이를 다시 사용합니다.
* 다음 예제 이름이 이 절차에 사용됩니다.
+
** 사이트_A
+
*** 업그레이드 전:
+
**** 노드_A_1 - 이전
**** 노드_A_2 - 이전


*** 업그레이드 후:
+
**** Node_A_1 - 신규
**** Node_A_2 - 신규




** 사이트_B
+
*** 업그레이드 전:
+
**** 노드_B_1 - 이전
**** 노드_B_2 - 이전


*** 업그레이드 후:
+
**** Node_B_1 - 신규
**** Node_B_2 - 신규










== MetroCluster IP 구성에서 컨트롤러를 업그레이드하기 위한 워크플로우

워크플로 다이어그램을 사용하여 업그레이드 작업을 계획할 수 있습니다.

image::../media/workflow_ip_upgrade.png[워크플로우 IP 업그레이드]



== 업그레이드를 준비하는 중입니다

기존 MetroCluster 구성을 변경하기 전에 구성 상태를 확인하고, 새 플랫폼을 준비하고, 기타 작업을 수행해야 합니다.



=== 컨트롤러를 업그레이드하기 전에 MetroCluster 스위치 RCF 파일을 업데이트합니다

이전 플랫폼 모델에 따라 또는 스위치 구성이 최소 버전이 아니거나 백엔드 MetroCluster 연결에 사용되는 VLAN ID를 변경하려는 경우 플랫폼 업그레이드 절차를 시작하기 전에 스위치 RCF 파일을 업데이트해야 합니다.

다음 시나리오에서 RCF 파일을 업데이트해야 합니다.

* 특정 플랫폼 모델의 경우 스위치는 백엔드 MetroCluster IP 연결에 지원되는 VLAN ID를 사용해야 합니다. 이전 또는 새로운 플랫폼 모델이 다음 표 * 에 있고 지원되는 VLAN ID를 사용하지 * 인 경우, 스위치 RCF 파일을 업데이트해야 합니다.
+

NOTE: 로컬 클러스터 연결에서는 모든 VLAN을 사용할 수 있으며 지정된 범위에 속할 필요는 없습니다.

+
|===


| 플랫폼 모델(기존 또는 신규) | 지원되는 VLAN ID입니다 


 a| 
** AFF A400

 a| 
** 10
** 20
** 101 ~ 4096 범위의 모든 값


|===
* 스위치 구성이 지원되는 최소 RCF 버전으로 구성되지 않았습니다.
+
|===


| 모델 전환 | RCF 파일 버전이 필요합니다 


 a| 
Cisco 3132Q-V
 a| 
1.7 이상



 a| 
Cisco 3232C
 a| 
1.7 이상



 a| 
Broadcom BES-53248
 a| 
1.3 이상

|===
* VLAN 구성을 변경하려고 합니다.
+
VLAN ID 범위는 101 ~ 4096입니다.



site_a의 컨트롤러가 업그레이드되면 site_a의 스위치가 업그레이드됩니다.

.단계
. 새로운 RCF 파일 적용을 위한 IP 스위치를 준비합니다.
+
에서 스위치 공급업체에 대한 섹션의 단계를 따릅니다 link:../install-ip/concept_considerations_differences.html["MetroCluster IP 설치 및 구성"].

+
** link:../install-ip/task_switch_config_broadcom.html["Broadcom IP 스위치를 출하 시 기본값으로 재설정합니다"]
** link:../install-ip/task_switch_config_cisco.html["Cisco IP 스위치를 출하 시 기본값으로 재설정합니다"]


. RCF 파일을 다운로드하고 설치합니다.
+
의 단계를 따릅니다 link:../install-ip/concept_considerations_differences.html["MetroCluster IP 설치 및 구성"].

+
** link:../install-ip/task_switch_config_broadcom.html["Broadcom RCF 파일 다운로드 및 설치"]
** link:../install-ip/task_switch_config_cisco.html["Cisco IP RCF 파일 다운로드 및 설치"]






=== 이전 노드에서 새 노드로 포트 매핑

node_A_1-old 맵의 물리적 포트가 node_A_1-new의 물리적 포트에 올바르게 연결되어 있는지 확인해야 합니다. 이렇게 하면 node_A_1-new가 클러스터의 다른 노드 및 업그레이드 후 네트워크와 통신할 수 있습니다.

업그레이드 프로세스 중에 새 노드를 처음 부팅하면 교체 중인 이전 노드의 최신 구성이 재생됩니다. node_A_1-new를 부팅할 때 ONTAP는 node_A_1-old에서 사용된 것과 동일한 포트에 LIF를 호스팅하려고 시도합니다. 따라서 업그레이드의 일환으로 포트와 LIF 구성이 이전 노드의 구성과 호환되도록 조정해야 합니다. 업그레이드 절차를 진행하는 동안 이전 노드와 새 노드 모두에서 단계를 수행하여 클러스터, 관리 및 데이터 LIF 구성이 올바른지 확인할 수 있습니다.

다음 표에서는 새 노드의 포트 요구 사항과 관련된 구성 변경의 예를 보여 줍니다.

|===


3+| 클러스터 인터커넥트 물리적 포트 


| 더 오래 된 컨트롤러 | 새로운 컨트롤러 | 필요한 조치 


 a| 
e0a, e0b
 a| 
e3a, e3b
 a| 
일치하는 포트가 없습니다. 업그레이드 후에는 클러스터 포트를 다시 생성해야 합니다.



 a| 
e0c, e0d
 a| 
e0a, e0b, e0c, e0d
 a| 
e0c 및 e0d가 일치하는 포트입니다. 구성을 변경할 필요는 없지만, 업그레이드 후에는 사용 가능한 클러스터 포트에 클러스터 LIF를 분산할 수 있습니다.

|===
.단계
. 새 컨트롤러에서 사용할 수 있는 물리적 포트와 포트에서 호스팅할 수 있는 LIF를 확인합니다.
+
컨트롤러의 포트 사용량은 플랫폼 모듈과 MetroCluster IP 구성에서 사용할 스위치에 따라 다릅니다. 에서 새 플랫폼의 포트 사용량을 수집할 수 있습니다 link:https://hwu.netapp.com["NetApp Hardware Universe를 참조하십시오"].

. 포트 사용을 계획하고 새 노드 각각에 대한 참조를 위해 다음 표를 채웁니다.
+
업그레이드 절차를 수행할 때 표를 참조하십시오.

+
|===


|  3+| 노드_A_1 - 이전 3+| Node_A_1 - 신규 


| LIF | 포트 | IPspace | 브로드캐스트 도메인 | 포트 | IPspace | 브로드캐스트 도메인 


 a| 
클러스터 1
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
클러스터 2
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
클러스터 3
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
클러스터 4
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
노드 관리
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
클러스터 관리
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
데이터 1
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
데이터 2
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
데이터 3
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
데이터 4
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
산
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 



 a| 
인터클러스터 포트
 a| 
 a| 
 a| 
 a| 
 a| 
 a| 

|===




=== 새 컨트롤러를 Netbooting 합니다

새 노드를 설치한 후에는 Netboot를 사용하여 새 노드가 원래 노드와 동일한 버전의 ONTAP를 실행 중인지 확인해야 합니다. netboot라는 용어는 원격 서버에 저장된 ONTAP 이미지에서 부팅됨을 의미합니다. netboot를 준비할 때 시스템이 액세스할 수 있는 웹 서버에 ONTAP 9 부트 이미지 사본을 넣어야 합니다.

.단계
. 새 컨트롤러를 Netboot에 다음과 같이 합니다.
+
.. 에 액세스합니다 https://mysupport.netapp.com/site/["NetApp Support 사이트"] 시스템의 Netboot 수행에 사용되는 파일을 다운로드합니다.
.. NetApp Support 사이트의 소프트웨어 다운로드 섹션에서 해당 ONTAP 소프트웨어를 다운로드하고 웹 액세스 가능한 디렉토리에 'ONTAP-version_image.tgz' 파일을 저장합니다.
.. 웹 액세스 가능 디렉토리로 변경하고 필요한 파일을 사용할 수 있는지 확인합니다.
+
|===


| 플랫폼 모델이 다음과 같은 경우 | 그러면... 


 a| 
FAS/AFF8000 시리즈 시스템
 a| 
대상 디렉토리에 '__ONTAP-version__image.tgz' 파일의 내용을 추출합니다.

'tar-zxvf__ontap-version__image.tgz'


NOTE: Windows에서 내용을 추출하는 경우 7-Zip 또는 WinRAR을 사용하여 netboot 이미지를 추출합니다. 디렉토리 목록에는 커널 파일 netboot/kernel의 netboot 폴더가 포함되어야 합니다

디렉토리 목록에는 커널 파일이 있는 netboot 폴더가 포함되어야 합니다.

넷부트/커널



 a| 
기타 모든 시스템
 a| 
디렉토리 목록에는 커널 파일이 있는 netboot 폴더가 포함되어야 합니다.

'_ONTAP-version_image.tgz'

'_ONTAP-version_image.tgz' 파일을 추출할 필요가 없습니다.

|===
.. 로더 프롬프트에서 관리 LIF의 netboot 연결을 구성합니다.
+
|===


| IP 주소 지정이... | 그러면... 


 a| 
DHCP를 선택합니다
 a| 
자동 연결을 구성합니다.

ifconfig e0M-auto를 선택합니다



 a| 
정적
 a| 
수동 연결을 구성합니다.

'ifconfig e0M-addr=_ip_addr_-mask=_netmask_-GW=_gateway_'

|===
.. netboot 수행
+
|===


| 플랫폼 모델이 다음과 같은 경우 | 그러면... 


 a| 
FAS/AFF8000 시리즈 시스템
 a| 
네부트 http://_web_server_ip/path_to_web-accessible_directory_/netboot/kernel`[]



 a| 
기타 모든 시스템
 a| 
"netboot\http://_web_server_ip/path_to_web-accessible_directory/ontap-version_image.tgz`

|===
.. 부팅 메뉴에서 옵션**(7) Install new software first**(새 소프트웨어를 먼저 설치**)를 선택하여 새 소프트웨어 이미지를 다운로드하여 부팅 장치에 설치합니다.
+
다음 메시지는 무시하십시오.

+
""이 절차는 HA 쌍의 무중단 업그레이드에는 지원되지 않습니다." 무중단 소프트웨어 업그레이드에는 적용되며 컨트롤러 업그레이드에는 적용되지 않습니다.

.. 절차를 계속하라는 메시지가 나타나면 "y"를 입력하고 패키지를 입력하라는 메시지가 나타나면 이미지 파일의 URL을 입력합니다.
+
"http://__web_server_ip/path_to_web-accessible_directory/ontap-version___image.tgz`

.. 해당하는 경우 사용자 이름과 암호를 입력하거나 Enter 키를 눌러 계속합니다.
.. 다음과 유사한 프롬프트가 표시되면 백업 복구를 건너뛰려면 "n"을 입력해야 합니다.
+
[listing]
----
Do you want to restore the backup configuration now? {y|n} **n**
----
.. 다음과 유사한 프롬프트가 나타나면 '* y*'를 입력하여 재부팅합니다.
+
[listing]
----
The node must be rebooted to start using the newly installed software. Do you want to reboot now? {y|n}
----






=== 컨트롤러 모듈의 구성 지우기

[role="lead"]
MetroCluster 구성에서 새 컨트롤러 모듈을 사용하기 전에 기존 구성을 지워야 합니다.

.단계
. 필요한 경우 노드를 중지하고 로더 프롬프트를 표시합니다.
+
"중지"

. LOADER 프롬프트에서 환경 변수를 기본값으로 설정합니다.
+
세트 기본값

. 환경 저장:
+
'사베에프'

. LOADER 프롬프트에서 부팅 메뉴를 시작합니다.
+
boot_ontap 메뉴

. 부팅 메뉴 프롬프트에서 구성을 지웁니다.
+
휘폰무화과

+
확인 프롬프트에 yes로 응답합니다.

+
노드가 재부팅되고 부팅 메뉴가 다시 표시됩니다.

. 부팅 메뉴에서 옵션 * 5 * 를 선택하여 시스템을 유지보수 모드로 부팅합니다.
+
확인 프롬프트에 yes로 응답합니다.





=== 사이트 업그레이드 전에 MetroCluster 상태 확인

업그레이드를 수행하기 전에 MetroCluster 구성의 상태와 연결을 확인해야 합니다.

.단계
. ONTAP에서 MetroCluster 구성 작동을 확인합니다.
+
.. 노드 multipathed 여부 확인: + 'node run-node_node-name_sysconfig-a
+
MetroCluster 구성의 각 노드에 대해 이 명령을 실행해야 합니다.

.. 구성에서 손상된 디스크가 없는지 확인합니다. + '스토리지 디스크 표시 - 파손'
+
MetroCluster 구성의 각 노드에서 이 명령을 실행해야 합니다.

.. 상태 알림을 확인합니다.
+
'시스템 상태 경고 표시

+
각 클러스터에서 이 명령을 실행해야 합니다.

.. 클러스터의 라이센스를 확인합니다.
+
'시스템 사용권 프로그램'

+
각 클러스터에서 이 명령을 실행해야 합니다.

.. 노드에 연결된 디바이스를 확인합니다.
+
네트워크 디바이스 발견 쇼

+
각 클러스터에서 이 명령을 실행해야 합니다.

.. 두 사이트 모두에서 표준 시간대와 시간이 올바르게 설정되었는지 확인합니다.
+
'클러스터 날짜 표시'

+
각 클러스터에서 이 명령을 실행해야 합니다. 'cluster date' 명령을 사용하여 시간 및 시간대를 구성할 수 있습니다.



. MetroCluster 구성의 운영 모드를 확인하고 MetroCluster 검사를 수행합니다.
+
.. MetroCluster 설정을 확인하고 운영 모드가 정상 모드인지 확인한 후 MetroCluster show를 실행합니다
.. 예상되는 모든 노드가 표시되는지 확인합니다. + "MetroCluster node show"
.. 다음 명령을 실행합니다.
+
'MetroCluster check run

.. MetroCluster 검사 결과를 표시합니다.
+
MetroCluster 체크 쇼



. Config Advisor 도구를 사용하여 MetroCluster 케이블 연결을 확인합니다.
+
.. Config Advisor를 다운로드하고 실행합니다.
+
https://mysupport.netapp.com/site/tools/tool-eula/activeiq-configadvisor["NetApp 다운로드: Config Advisor"]

.. Config Advisor를 실행한 후 도구의 출력을 검토하고 출력에서 권장 사항을 따라 발견된 문제를 해결하십시오.






=== 업그레이드 전에 정보를 수집하는 중입니다

업그레이드하기 전에 각 노드에 대한 정보를 수집하고, 필요한 경우 네트워크 브로드캐스트 도메인을 조정하고, VLAN 및 인터페이스 그룹을 제거하고, 암호화 정보를 수집해야 합니다.

.단계
. 각 노드의 물리적 케이블 연결을 기록하고 필요에 따라 새 노드의 올바른 케이블 연결을 허용하도록 케이블에 레이블을 지정합니다.
. 각 노드에 대한 상호 연결, 포트 및 LIF 정보를 수집합니다.
+
각 노드에 대해 다음 명령의 출력을 수집해야 합니다.

+
** MetroCluster interconnect show
** 'MetroCluster configuration-settings connection show'를 선택합니다
** 네트워크 인터페이스 show-role cluster, node-mgmt
** 네트워크 포트 show-node node_name-type physical
** 'network port vlan show-node_node-name _'
** 'network port ifgrp show -node_node_name_-instance'
** 네트워크 포트 브로드캐스트 도메인 쇼
** 네트워크 포트 도달 가능성 세부 정보
** 네트워크 IPspace 쇼
** '볼륨 쇼'
** '스토리지 집계 쇼'
** 'system node run-node_node-name_sysconfig-a'
** 'vserver fcp initiator show'를 선택합니다
** 스토리지 디스크 쇼
** 'MetroCluster configuration-settings interface show'를 선택합니다


. Site_B(플랫폼을 현재 업그레이드 중인 사이트)의 UUID를 수집합니다.
+
'MetroCluster node show-fields node-cluster-uuid, node-uuuid

+
성공적으로 업그레이드하려면 새 site_B 컨트롤러 모듈에서 이러한 값을 정확하게 구성해야 합니다. 나중에 업그레이드 프로세스에서 올바른 명령으로 복사할 수 있도록 값을 파일에 복사합니다.

+
다음 예는 UUID를 사용한 명령 출력을 보여 줍니다.

+
[listing]
----
cluster_B::> metrocluster node show -fields node-cluster-uuid, node-uuid
  (metrocluster node show)
dr-group-id cluster     node   node-uuid                            node-cluster-uuid
----------- --------- -------- ------------------------------------ ------------------------------
1           cluster_A node_A_1 f03cb63c-9a7e-11e7-b68b-00a098908039 ee7db9d5-9a82-11e7-b68b-00a098908039
1           cluster_A node_A_2 aa9a7a7a-9a81-11e7-a4e9-00a098908c35 ee7db9d5-9a82-11e7-b68b-00a098908039
1           cluster_B node_B_1 f37b240b-9ac1-11e7-9b42-00a098c9e55d 07958819-9ac6-11e7-9b42-00a098c9e55d
1           cluster_B node_B_2 bf8e3f8f-9ac4-11e7-bd4e-00a098ca379f 07958819-9ac6-11e7-9b42-00a098c9e55d
4 entries were displayed.
cluster_B::*
----
+
UUID를 다음과 유사한 테이블에 기록하는 것이 좋습니다.

+
|===


| 클러스터 또는 노드 | UUID입니다 


 a| 
클러스터_B
 a| 
07958819-9ac6-11e7-9b42-00a098c9e55d



 a| 
노드_B_1
 a| 
f37b240b-9ac1-11e7-9b42-00a098c9e55d



 a| 
노드_B_2
 a| 
bf8e3f8f-9ac4-11e7-bd4e-00a098ca379f



 a| 
클러스터_A
 a| 
ee7db9d5-9a82-11e7-b68b-00a098908039



 a| 
노드_A_1
 a| 
f03cb63c-9a7e-11e7-b68b-00a098908039



 a| 
노드_A_2
 a| 
a9a7a7a-9a81-11e7-a4e9-00a098908c35

|===
. MetroCluster 노드가 SAN 구성에 있는 경우 관련 정보를 수집합니다.
+
다음 명령의 출력을 수집해야 합니다.

+
** FCP 어댑터 show-instance(FCP 어댑터 show-instance)
** FCP 인터페이스의 show-instance입니다
** iSCSI 인터페이스 쇼
** 'ucadmin 쇼'


. 루트 볼륨이 암호화된 경우 키 관리자에 사용되는 암호를 수집하여 저장합니다.
+
보안 키 관리자 백업 쇼

. MetroCluster 노드가 볼륨 또는 애그리게이트에 암호화를 사용하는 경우 키 및 암호 문구를 복사합니다.
+
자세한 내용은 을 참조하십시오 https://docs.netapp.com/ontap-9/topic/com.netapp.doc.pow-nve/GUID-1677AE0A-FEF7-45FA-8616-885AA3283BCF.html["온보드 키 관리 정보를 수동으로 백업합니다"].

+
.. Onboard Key Manager가 설정된 경우: +'보안 키 관리자 온보드 show-backup
+
나중에 업그레이드 절차에서 암호가 필요합니다.

.. 엔터프라이즈 키 관리(KMIP)를 구성한 경우 다음 명령을 실행하십시오.
+
'보안 키 관리자 외부 쇼 인스턴스' 보안 키 관리자 키 쿼리



. 기존 노드의 시스템 ID 수집:
+
MetroCluster node show-fields node-systemid, ha-partner-systemid, dr-partner-systemid, dr-auxiliary-systemid

+
다음 출력은 재할당된 드라이브를 보여 줍니다.

+
[listing]
----
::> metrocluster node show -fields node-systemid,ha-partner-systemid,dr-partner-systemid,dr-auxiliary-systemid

dr-group-id cluster     node     node-systemid ha-partner-systemid dr-partner-systemid dr-auxiliary-systemid
----------- ----------- -------- ------------- ------------------- ------------------- ---------------------
1           cluster_A node_A_1   537403324     537403323           537403321           537403322
1           cluster_A node_A_2   537403323     537403324           537403322           537403321
1           cluster_B node_B_1   537403322     537403321           537403323           537403324
1           cluster_B node_B_2   537403321     537403322           537403324           537403323
4 entries were displayed.
----




=== 중재자 또는 타이차단기 모니터링 제거

플랫폼을 업그레이드하기 전에 Tiebreaker 또는 중재자 유틸리티를 사용하여 MetroCluster 구성을 모니터링하는 경우 모니터링을 제거해야 합니다.

.단계
. 다음 명령의 출력을 수집합니다.
+
'Storage iSCSI-initiator show'를 선택합니다

. 전환을 시작할 수 있는 Tiebreaker, 중재자 또는 기타 소프트웨어에서 기존 MetroCluster 구성을 제거합니다.
+
|===


| 사용 중인 경우... | 다음 절차를 사용하십시오. 


 a| 
Tiebreaker입니다
 a| 
http://docs.netapp.com/ontap-9/topic/com.netapp.doc.hw-metrocluster-tiebreaker/GUID-34C97A45-0BFF-46DD-B104-2AB2805A983D.html["MetroCluster 구성 제거"] MetroCluster Tiebreaker 설치 및 구성 가이드 _



 a| 
중재자
 a| 
ONTAP 프롬프트에서 다음 명령을 실행합니다.

'MetroCluster configuration-settings 중재자 제거



 a| 
타사 응용 프로그램
 a| 
제품 설명서를 참조하십시오.

|===




=== 유지 관리 전에 사용자 지정 AutoSupport 메시지를 보냅니다

유지보수를 수행하기 전에 AutoSupport 메시지를 발행하여 NetApp 기술 지원 팀에 유지보수 진행 중임을 알려야 합니다. 유지 관리가 진행 중임을 기술 지원 부서에 알리는 것은 운영 중단이 발생했다는 가정 하에 사례가 열리지 않도록 방지합니다.

이 작업은 각 MetroCluster 사이트에서 수행해야 합니다.

.단계
. 클러스터에 로그인합니다.
. 유지 관리의 시작을 나타내는 AutoSupport 메시지를 호출합니다.
+
'시스템 노드 AutoSupport invoke-node * -type all-message maINT=__maintenance -window-in-hours_'

+
유지보수 윈도우 시간(main유지보수-window-in-hours) 매개변수는 유지보수 윈도우 길이를 최대 72시간으로 지정합니다. 시간이 경과하기 전에 유지 관리가 완료된 경우 유지 보수 기간이 종료되었음을 나타내는 AutoSupport 메시지를 호출할 수 있습니다.

+
'System node AutoSupport invoke-node * -type all-message maINT=end'

. 파트너 사이트에서 이 단계를 반복합니다.




== MetroCluster 구성을 전환합니다

site_B의 플랫폼을 업그레이드할 수 있도록 구성을 site_A로 전환해야 합니다.

이 작업은 site_A에서 수행해야 합니다

이 작업을 완료하면 cluster_a가 활성 상태이며 두 사이트에 대한 데이터를 제공합니다. Cluster_B가 비활성화되어 업그레이드 프로세스를 시작할 준비가 되었습니다.

image::../media/mcc_upgrade_cluster_a_in_switchover.png[전환 중인 MCC 업그레이드 클러스터 A]

.단계
. site_B의 노드를 업그레이드할 수 있도록 MetroCluster 구성을 site_A로 전환합니다.
+
.. cluster_a에서 다음 명령을 실행합니다.
+
'MetroCluster switchover - controller-replacement true'

+
작업을 완료하는 데 몇 분 정도 걸릴 수 있습니다.

.. 절체 동작 모니터링:
+
MetroCluster 동작쇼

.. 작업이 완료된 후 노드가 절체 상태에 있는지 확인합니다.
+
MetroCluster 쇼

.. MetroCluster 노드의 상태를 점검한다.
+
'MetroCluster node show'

+
컨트롤러 업그레이드 중에 협상된 전환 후 애그리게이트 자동 복구가 해제됩니다.







== 인터페이스 구성을 제거하고 이전 컨트롤러를 제거합니다

데이터 LIF를 공통 포트로 이동하고, 이전 컨트롤러에서 VLAN 및 인터페이스 그룹을 제거한 다음, 컨트롤러를 물리적으로 제거해야 합니다.

.이 작업에 대해
* 이러한 단계는 이전 컨트롤러(node_B_1 - old, node_B_2 - old)에서 수행됩니다.
* 에서 수집한 정보를 참조하십시오 link:task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html["이전 노드에서 새 노드로 포트 매핑"].


.단계
. 이전 노드를 부팅하고 노드에 로그인합니다.
+
부트 ONTAP

. 이전 컨트롤러에 있는 모든 데이터 LIF의 홈 포트를 이전 컨트롤러 모듈과 새로운 컨트롤러 모듈 모두에서 동일한 공통 포트에 할당합니다.
+
.. LIF 표시:
+
네트워크 인터페이스 쇼

+
SAN 및 NAS를 포함한 모든 데이터 LIF는 전환 사이트(cluster_a)에서 가동되므로 관리 및 운영 중단 기능이 있습니다.

.. 출력을 검토하여 클러스터 포트로 사용되지 않는 이전 컨트롤러와 새 컨트롤러 모두에서 동일한 일반적인 물리적 네트워크 포트를 찾습니다.
+
예를 들어, e0d는 이전 컨트롤러의 물리적 포트이며 새 컨트롤러에도 존재합니다. e0d는 클러스터 포트 또는 새 컨트롤러에 사용되지 않습니다.

+
플랫폼 모델의 포트 사용은 를 참조하십시오 https://hwu.netapp.com/["NetApp Hardware Universe를 참조하십시오"]

.. 공통 포트를 홈 포트로 사용하도록 모든 데이터 LIFS를 수정합니다. + 'network interface modify -vserver_svm -name_-lif_data-lif_-home-port_port -id_'
+
다음 예에서는 "e0d"입니다.

+
예를 들면 다음과 같습니다.

+
[listing]
----
network interface modify -vserver vs0 -lif datalif1 -home-port e0d
----


. 클러스터 포트를 구성원 포트로 사용하고 클러스터 포트를 구성원 포트로 사용하여 ifgrp를 사용하는 VLAN 포트를 모두 제거합니다.
+
.. VLAN 포트 삭제: + 'network port vlan delete-node_node-name_-vlan-name_portID-vlanDID_'
+
예를 들면 다음과 같습니다.

+
[listing]
----
network port vlan delete -node node1 -vlan-name e1c-80
----
.. 인터페이스 그룹에서 물리적 포트를 제거합니다.
+
'network port ifgrp remove-port-node_node-name_-ifgrp_interface-group-name_-port_portID_'

+
예를 들면 다음과 같습니다.

+
[listing]
----
network port ifgrp remove-port -node node1 -ifgrp a1a -port e0d
----
.. 브로드캐스트 도메인에서 VLAN 및 인터페이스 그룹 포트 제거:
+
"네트워크 포트 브로드캐스트-도메인 제거-포트-IPSpace_IPSpace_-broadcast-domain_broadcast-domain-name_-ports_nodename:portname,nodname:portname_,."

.. 필요에 따라 다른 물리적 포트를 구성원으로 사용하도록 인터페이스 그룹 포트를 수정합니다.
+
'ifgrp add-port-node_node-name_-ifgrp_interface-group-name_-port_port-id_'



. LOADER 프롬프트에서 노드를 중단합니다.
+
'HALT-INHIBIT-Takeover TRUE'

. site_B에 있는 이전 컨트롤러(node_B_1-old 및 node_B_2-old)의 시리얼 콘솔에 연결하고 로더 프롬프트가 표시되는지 확인합니다.
. bootarg 값을 수집합니다.
+
'printenv'

. node_B_1-old 및 node_B_2-old에서 스토리지 및 네트워크 연결을 끊고 새 노드에 다시 연결할 수 있도록 케이블에 레이블을 지정합니다.
. node_B_1 - old 및 node_B_2 - old에서 전원 케이블을 분리합니다.
. 랙에서 node_B_1-old 및 node_B_2-old 컨트롤러를 분리합니다.




== 새로운 플랫폼을 수용하기 위해 스위치 RCF를 업데이트합니다

새 플랫폼 모델을 지원하는 구성으로 스위치를 업데이트해야 합니다.

현재 업그레이드 중인 컨트롤러가 포함된 사이트에서 이 작업을 수행합니다. 이 절차의 예에서는 먼저 site_B를 업그레이드하고 있습니다.

site_a의 컨트롤러가 업그레이드되면 site_a의 스위치가 업그레이드됩니다.

.단계
. 새로운 RCF 파일 적용을 위한 IP 스위치를 준비합니다.
+
스위치 공급업체에 대한 절차의 단계를 따르십시오.

+
link:../install-ip/concept_considerations_differences.html["MetroCluster IP 설치 및 구성"]

+
** link:../install-ip/task_switch_config_broadcom.html["Broadcom IP 스위치를 출하 시 기본값으로 재설정합니다"]
** link:../install-ip/task_switch_config_cisco.html["Cisco IP 스위치를 출하 시 기본값으로 재설정합니다"]


. RCF 파일을 다운로드하고 설치합니다.
+
에서 스위치 공급업체에 대한 섹션의 단계를 따릅니다 link:../install-ip/concept_considerations_differences.html["MetroCluster IP 설치 및 구성"].

+
** link:../install-ip/task_switch_config_broadcom.html["Broadcom RCF 파일 다운로드 및 설치"]
** link:../install-ip/task_switch_config_cisco.html["Cisco IP RCF 파일 다운로드 및 설치"]






== 새 컨트롤러 구성

컨트롤러를 랙에 설치하고 유지보수 모드에서 필요한 설정을 수행한 다음 컨트롤러를 부팅하고 LIF 구성을 확인해야 합니다.



=== 새 컨트롤러 설정

새 컨트롤러를 랙에 장착하고 케이블을 연결해야 합니다.

.단계
. 필요에 따라 새 컨트롤러 모듈 및 스토리지 쉘프를 포지셔닝합니다.
+
랙 공간은 컨트롤러 모듈의 플랫폼 모델, 스위치 유형 및 구성의 스토리지 쉘프 수에 따라 다릅니다.

. 적절하게 접지합니다.
. 랙 또는 캐비닛에 컨트롤러 모듈을 설치합니다.
+
https://docs.netapp.com/platstor/index.jsp["AFF and FAS 문서 센터 를 참조하십시오"]

. 에 설명된 대로 컨트롤러를 IP 스위치에 연결합니다 link:../install-ip/concept_considerations_differences.html["MetroCluster IP 설치 및 구성"].
+
** link:["IP 스위치 케이블 연결"]


. 새 노드의 전원을 켜고 유지보수 모드로 부팅합니다.




=== HBA 구성을 복구합니다

컨트롤러 모듈에 있는 HBA 카드의 존재 여부와 구성에 따라 사이트 용도에 맞게 HBA 카드를 올바르게 구성해야 합니다.

.단계
. 유지 관리 모드에서 시스템의 모든 HBA에 대한 설정을 구성합니다.
+
.. 포트의 현재 설정을 확인합니다.
+
'ucadmin 쇼'

.. 필요에 따라 포트 설정을 업데이트합니다.


+
|===


| 이 유형의 HBA와 원하는 모드가 있는 경우... | 이 명령 사용... 


 a| 
CNA FC
 a| 
'ucadmin modify -m fc -t initiator_adapter-name_'



 a| 
CNA 이더넷
 a| 
'ucadmin modify-mode CNA_adapter-name _'



 a| 
FC 타겟
 a| 
'fcadmin config -t target_adapter-name_'



 a| 
FC 이니시에이터
 a| 
'fcadmin config -t initiator_adapter-name_'

|===
. 유지 관리 모드 종료:
+
"중지"

+
명령을 실행한 후 LOADER 프롬프트에서 노드가 중지될 때까지 기다립니다.

. 노드를 유지보수 모드로 다시 부팅하여 구성 변경 사항이 적용되도록 합니다.
+
boot_ONTAP maint를 선택합니다

. 변경 사항을 확인합니다.
+
|===


| 이 유형의 HBA가 있는 경우... | 이 명령 사용... 


 a| 
CNA
 a| 
'ucadmin 쇼'



 a| 
FC
 a| 
fcadmin 쇼

|===




=== 새 컨트롤러 및 섀시의 HA 상태 설정

컨트롤러 및 섀시의 HA 상태를 확인하고, 필요한 경우 시스템 구성에 맞게 상태를 업데이트해야 합니다.

.단계
. 유지보수 모드에서 컨트롤러 모듈 및 섀시의 HA 상태를 표시합니다.
+
하구성 쇼

+
모든 부품의 HA 상태는 'mcip'이어야 한다.

. 컨트롤러 또는 섀시의 시스템 상태가 표시되지 않으면 HA 상태를 설정합니다.
+
ha-config modify controller mcip.(컨트롤러 mccip 수정

+
ha-config modify chassis mccip.(섀시 mcip 수정





=== MetroCluster IP bootarg 변수 설정

특정 MetroCluster IP bootarg 값은 새 컨트롤러 모듈에서 구성해야 합니다. 이 값은 이전 컨트롤러 모듈에 구성된 값과 일치해야 합니다.

이 작업에서는 의 업그레이드 절차에서 앞서 확인한 UUID 및 시스템 ID를 사용합니다 link:task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html["업그레이드 전에 정보를 수집하는 중입니다"].

.단계
. 업그레이드하는 노드가 AFF A400, FAS8300 또는 FAS8700 모델인 경우 LOADER 프롬프트에서 다음 boots를 설정합니다.
+
'setenv bootarg.MCC.port_a_ip_config_local -ip-address/local-ip-mask, 0, HA-partner-ip-address, dr-partner-ip-address, dr-aux-partnerip-address, vlan-id_'

+
'setenv bootarg.MCC.port_b_ip_config_local -ip-address/local-ip-mask, 0, HA-partner-ip-address, dr-partner-ip-address, dr-aux-partnerip-address, vlan-id_'

+

NOTE: 인터페이스가 기본 VLAN을 사용하는 경우에는 VLAN-id가 필요하지 않습니다.

+
다음 명령을 실행하면 첫 번째 네트워크에 대해 VLAN 120을 사용하고 두 번째 네트워크에 대해 VLAN 130을 사용하여 node_B_1-new에 대한 값이 설정됩니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.10/23,0,172.17.26.11,172.17.26.13,172.17.26.12,120
setenv bootarg.mcc.port_b_ip_config 172.17.27.10/23,0,172.17.27.11,172.17.27.13,172.17.27.12,130
----
+
다음 명령을 실행하면 첫 번째 네트워크에 대해 VLAN 120을 사용하고 두 번째 네트워크에 대해 VLAN 130을 사용하여 node_B_2-new에 대한 값이 설정됩니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.11/23,0,172.17.26.10,172.17.26.12,172.17.26.13,120
setenv bootarg.mcc.port_b_ip_config 172.17.27.11/23,0,172.17.27.10,172.17.27.12,172.17.27.13,130
----
+
다음 예에서는 기본 VLAN을 사용할 때 node_B_1-new에 대한 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.10/23,0,172.17.26.11,172.17.26.13,172.17.26.12
setenv bootarg.mcc.port_b_ip_config 172.17.27.10/23,0,172.17.27.11,172.17.27.13,172.17.27.12
----
+
다음 예에서는 기본 VLAN을 사용할 때 node_B_2-new에 대한 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.11/23,0,172.17.26.10,172.17.26.12,172.17.26.13
setenv bootarg.mcc.port_b_ip_config 172.17.27.11/23,0,172.17.27.10,172.17.27.12,172.17.27.13
----
. 업그레이드 중인 노드가 이전 단계에 나열된 시스템이 아닌 경우, 로더 프롬프트에서 남아 있는 각 노드에 대해 다음 boots를 local_ip/mask로 설정합니다.
+
'setenv bootarg.MCC.port_a_ip_config_local -ip-address/local-ip-mask, 0, HA-partner-ip-address, dr-partner-ip-address, dr-aux-partnerip-address_'

+
'setenv bootarg.MCC.port_b_ip_config_local-ip-address/local-ip-mask, 0, HA-partner-ip-address, dr-partner-ip-address, dr-aux-partnerip-address_'

+
다음 명령을 실행하면 node_B_1-new에 대한 값이 설정됩니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.10/23,0,172.17.26.11,172.17.26.13,172.17.26.12
setenv bootarg.mcc.port_b_ip_config 172.17.27.10/23,0,172.17.27.11,172.17.27.13,172.17.27.12
----
+
다음 명령을 실행하면 node_B_2-new에 대한 값이 설정됩니다.

+
[listing]
----
setenv bootarg.mcc.port_a_ip_config 172.17.26.11/23,0,172.17.26.10,172.17.26.12,172.17.26.13
setenv bootarg.mcc.port_b_ip_config 172.17.27.11/23,0,172.17.27.10,172.17.27.12,172.17.27.13
----
. 새 노드의 LOADER 프롬프트에서 UUID를 설정합니다.
+
'setenv bootarg.mgwd.partner_cluster_uuuid_partner-cluster-UUID_'

+
'setenv bootarg.mgwd.cluster_uuuid_local-cluster-UUID_'

+
'setenv bootarg.mcc.pri_partner_uuuid_dr-partner-node-UUID_'

+
'setenv bootarg.mcc.aux_partner_uuid_dr-aux-partner-node-UUID_'

+
'setenv bootarg.mcc_iscsi.node_uuid_local-node-UUID_'

+
.. node_B_1-new에서 UUID를 설정합니다.
+
다음 예에서는 node_B_1-new에서 UUID를 설정하기 위한 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mgwd.cluster_uuid ee7db9d5-9a82-11e7-b68b-00a098908039
setenv bootarg.mgwd.partner_cluster_uuid 07958819-9ac6-11e7-9b42-00a098c9e55d
setenv bootarg.mcc.pri_partner_uuid f37b240b-9ac1-11e7-9b42-00a098c9e55d
setenv bootarg.mcc.aux_partner_uuid bf8e3f8f-9ac4-11e7-bd4e-00a098ca379f
setenv bootarg.mcc_iscsi.node_uuid f03cb63c-9a7e-11e7-b68b-00a098908039
----
.. node_B_2에서 UUID 설정 - 신규:
+
다음 예에서는 node_B_2-new에서 UUID를 설정하기 위한 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mgwd.cluster_uuid ee7db9d5-9a82-11e7-b68b-00a098908039
setenv bootarg.mgwd.partner_cluster_uuid 07958819-9ac6-11e7-9b42-00a098c9e55d
setenv bootarg.mcc.pri_partner_uuid bf8e3f8f-9ac4-11e7-bd4e-00a098ca379f
setenv bootarg.mcc.aux_partner_uuid f37b240b-9ac1-11e7-9b42-00a098c9e55d
setenv bootarg.mcc_iscsi.node_uuid aa9a7a7a-9a81-11e7-a4e9-00a098908c35
----


. 원래 시스템이 ADP에 대해 구성된 경우 각 교체 노드의 LOADER 프롬프트에서 ADP를 활성화합니다.
+
'etenv bootarg.MCC.adp_enabled true'

. 다음 변수를 설정합니다.
+
'setenv bootarg.MCC.local_config_id_original-sys-id_'

+
'etenv boottar.MCC.dr_partner_dr-partner-sys-id_'

+

NOTE: 'setenv bootarg.local_config_id' 변수는 * original * controller module, node_B_1-old의 sys-id로 설정되어야 한다.

+
.. node_B_1-new에 변수를 설정합니다.
+
다음 예는 node_B_1-new에서 값을 설정하는 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mcc.local_config_id 537403322
setenv bootarg.mcc.dr_partner 537403324
----
.. node_B_2-new에 변수를 설정합니다.
+
다음 예는 node_B_2-new에서 값을 설정하는 명령을 보여 줍니다.

+
[listing]
----
setenv bootarg.mcc.local_config_id 537403321
setenv bootarg.mcc.dr_partner 537403323
----


. 외부 키 관리자와 함께 암호화를 사용하는 경우 필요한 boots를 설정합니다.
+
세테네 bootarg.kmip.init.ipaddr`

+
세테네 bootarg.kmip.kmip.init.netmask`

+
세테네 bootarg.kmip.kmip.init.gateway`

+
세테네 bootarg.kmip.kmip.init.interface`





=== 루트 애그리게이트 디스크를 다시 할당합니다

앞에서 수집한 sysids를 사용하여 루트 애그리게이트 디스크를 새 컨트롤러 모듈에 다시 할당합니다.

이러한 단계는 유지 관리 모드에서 수행됩니다.

.단계
. 시스템을 유지보수 모드로 부팅합니다.
+
boot_ONTAP maint를 선택합니다

. 유지보수 모드 프롬프트에서 node_B_1에 새 디스크를 표시합니다.
+
'디스크 쇼-A'

+
명령 출력에는 새 컨트롤러 모듈의 시스템 ID(1574774970)가 표시됩니다. 그러나 루트 애그리게이트 디스크는 여전히 이전 시스템 ID(537403322)가 소유합니다. 이 예는 MetroCluster 구성에서 다른 노드가 소유한 드라이브를 표시하지 않습니다.

+
[listing]
----
*> disk show -a
Local System ID: 1574774970
DISK                  OWNER                 POOL   SERIAL NUMBER   HOME                  DR HOME
------------          ---------             -----  -------------   -------------         -------------
prod3-rk18:9.126L44   node_B_1-old(537403322)  Pool1  PZHYN0MD     node_B_1-old(537403322)  node_B_1-old(537403322)
prod4-rk18:9.126L49   node_B_1-old(537403322)  Pool1  PPG3J5HA     node_B_1-old(537403322)  node_B_1-old(537403322)
prod4-rk18:8.126L21   node_B_1-old(537403322)  Pool1  PZHTDSZD     node_B_1-old(537403322)  node_B_1-old(537403322)
prod2-rk18:8.126L2    node_B_1-old(537403322)  Pool0  S0M1J2CF     node_B_1-old(537403322)  node_B_1-old(537403322)
prod2-rk18:8.126L3    node_B_1-old(537403322)  Pool0  S0M0CQM5     node_B_1-old(537403322)  node_B_1-old(537403322)
prod1-rk18:9.126L27   node_B_1-old(537403322)  Pool0  S0M1PSDW     node_B_1-old(537403322)  node_B_1-old(537403322)
.
.
.
----
. 드라이브 쉘프의 루트 애그리게이트 디스크를 새 컨트롤러에 재할당합니다.
+
|===


| ADP를 사용하는 경우... | 다음 명령을 사용하십시오. 


 a| 
예
 a| 
"디스크 재할당 -s_old -sysid_ -d_new -sysid_ -r_dr -partner -sysid_"



 a| 
아니요
 a| 
"디스크 재할당 -s_old-sysid_-d_new-sysid_"

|===
. 드라이브 쉘프의 루트 애그리게이트 디스크를 새 컨트롤러에 재할당합니다.
+
'Disk reassign-s old-sysid-d new-sysid'

+
다음 예에서는 비 ADP 구성에서 드라이브 재할당을 보여 줍니다.

+
[listing]
----
*> disk reassign -s 537403322 -d 1574774970
Partner node must not be in Takeover mode during disk reassignment from maintenance mode.
Serious problems could result!!
Do not proceed with reassignment if the partner is in takeover mode. Abort reassignment (y/n)? n

After the node becomes operational, you must perform a takeover and giveback of the HA partner node to ensure disk reassignment is successful.
Do you want to continue (y/n)? y
Disk ownership will be updated on all disks previously belonging to Filer with sysid 537403322.
Do you want to continue (y/n)? y
----
. 루트 애그리게이트의 디스크가 적절하게 재할당되었는지 확인합니다. 기존 제거:
+
'디스크 쇼'

+
'스토리지 애그리게이션 상태

+
[listing]
----

*> disk show
Local System ID: 537097247

  DISK                    OWNER                    POOL   SERIAL NUMBER   HOME                     DR HOME
------------              -------------            -----  -------------   -------------            -------------
prod03-rk18:8.126L18 node_B_1-new(537097247)  Pool1  PZHYN0MD        node_B_1-new(537097247)   node_B_1-new(537097247)
prod04-rk18:9.126L49 node_B_1-new(537097247)  Pool1  PPG3J5HA        node_B_1-new(537097247)   node_B_1-new(537097247)
prod04-rk18:8.126L21 node_B_1-new(537097247)  Pool1  PZHTDSZD        node_B_1-new(537097247)   node_B_1-new(537097247)
prod02-rk18:8.126L2  node_B_1-new(537097247)  Pool0  S0M1J2CF        node_B_1-new(537097247)   node_B_1-new(537097247)
prod02-rk18:9.126L29 node_B_1-new(537097247)  Pool0  S0M0CQM5        node_B_1-new(537097247)   node_B_1-new(537097247)
prod01-rk18:8.126L1  node_B_1-new(537097247)  Pool0  S0M1PSDW        node_B_1-new(537097247)   node_B_1-new(537097247)
::>
::> aggr status
           Aggr          State           Status                Options
aggr0_node_B_1           online          raid_dp, aggr         root, nosnap=on,
                                         mirrored              mirror_resync_priority=high(fixed)
                                         fast zeroed
                                         64-bit
----




=== 새 컨트롤러를 부팅합니다

bootarg 변수가 올바른지 확인하고 필요한 경우 암호화 복구 단계를 수행하기 위해 새 컨트롤러를 부팅해야 합니다.

.단계
. 새 노드를 중단합니다.
+
"중지"

. 외부 키 관리자가 구성된 경우 관련 boots를 설정합니다.
+
'bootarg.kmip.init.ipaddr_ip-address_'

+
'셋틴 bootarg.kmip.init.netmask_netmask_'

+
'bootarg.kmip.init.gateway_gateway-address_'

+
'setenv bootarg.kmip.init.interface_interface-id_'

. partner-sysid가 현재인지 확인합니다.
+
'printenv partner-sysid

+
partner-sysid가 올바르지 않으면 다음을 설정합니다.

+
'setenv PARTNER-sysid_PARTNER-sysid_'

. ONTAP 부팅 메뉴를 표시합니다.
+
boot_ontap 메뉴

. 루트 암호화를 사용하는 경우 키 관리 구성에 대한 부팅 메뉴 옵션을 선택합니다.
+
|===


| 사용 중인 경우... | 이 부팅 메뉴 옵션을 선택합니다... 


 a| 
온보드 키 관리
 a| 
옵션 '10'

프롬프트에 따라 키 관리자 구성을 복구 및 복원하는 데 필요한 입력을 제공합니다.



 a| 
외부 키 관리
 a| 
옵션 '11'

프롬프트에 따라 키 관리자 구성을 복구 및 복원하는 데 필요한 입력을 제공합니다.

|===
. 부팅 메뉴에서 ""(6) Update flash from backup config"(백업 구성에서 플래시 업데이트)를 선택합니다.
+

NOTE: 옵션 6은 완료하기 전에 노드를 두 번 재부팅합니다.

+
시스템 ID 변경 프롬프트에 ""y""를 응답합니다. 두 번째 재부팅 메시지가 나타날 때까지 기다립니다.

+
[listing]
----
Successfully restored env file from boot media...

Rebooting to load the restored env file...
----
. 로더에서 bootarg 값을 두 번 확인하고 필요에 따라 값을 업데이트합니다.
+
의 단계를 사용합니다 link:task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html["MetroCluster IP bootarg 변수 설정"].

. partner-sysid가 올바른지 다시 확인합니다.
+
'printenv partner-sysid

+
partner-sysid가 올바르지 않으면 다음을 설정합니다.

+
'setenv PARTNER-sysid_PARTNER-sysid_'

. 루트 암호화를 사용하는 경우 키 관리 구성에 대해 부팅 메뉴 옵션을 다시 선택합니다.
+
|===


| 사용 중인 경우... | 이 부팅 메뉴 옵션을 선택합니다... 


 a| 
온보드 키 관리
 a| 
옵션 '10'

프롬프트에 따라 키 관리자 구성을 복구 및 복원하는 데 필요한 입력을 제공합니다.



 a| 
외부 키 관리
 a| 
옵션 "'11'"

프롬프트에 따라 키 관리자 구성을 복구 및 복원하는 데 필요한 입력을 제공합니다.

|===
+
키 관리자 설정에 따라 첫 번째 부팅 메뉴 프롬프트에서 옵션 ""10"" 또는 옵션 ""11", 옵션 "6"을 차례로 선택하여 복구 절차를 수행합니다. 노드를 완전히 부팅하려면 옵션 ""1"(일반 부팅)에서 계속 진행하는 복구 절차를 반복해야 할 수 있습니다.

. 교체된 노드가 부팅될 때까지 기다립니다.
+
두 노드 중 하나가 Takeover 모드에 있으면 'storage failover 반환' 명령을 사용하여 Giveback을 수행합니다.

. 암호화가 사용되는 경우 키 관리 구성에 맞는 명령을 사용하여 키를 복원합니다.
+
|===


| 사용 중인 경우... | 이 명령 사용... 


 a| 
온보드 키 관리
 a| 
보안 키매니저 온보드 동기화

자세한 내용은 을 참조하십시오 https://docs.netapp.com/ontap-9/topic/com.netapp.doc.pow-nve/GUID-E4AB2ED4-9227-4974-A311-13036EB43A3D.html["온보드 키 관리 암호화 키를 복원하는 중입니다"].



 a| 
외부 키 관리
 a| 
'Security key-manager external restore-vserver_SVM_-node_node_-key-server_host_name|ip_address:port_-key-id key_id-key-tag key_tag_node-name_'

자세한 내용은 을 참조하십시오 https://docs.netapp.com/ontap-9/topic/com.netapp.doc.pow-nve/GUID-32DA96C3-9B04-4401-92B8-EAF323C3C863.html["외부 키 관리 암호화 키 복원"].

|===
. 모든 포트가 브로드캐스트 도메인에 있는지 확인합니다.
+
.. 브로드캐스트 도메인 보기:
+
네트워크 포트 브로드캐스트 도메인 쇼

.. 필요에 따라 브로드캐스트 도메인에 포트를 추가합니다.
+
https://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-nmg/GUID-003BDFCD-58A3-46C9-BF0C-BA1D1D1475F9.html["브로드캐스트 도메인에서 포트 추가 또는 제거"]

.. 필요에 따라 VLAN 및 인터페이스 그룹을 다시 생성합니다.
+
VLAN 및 인터페이스 그룹 멤버쉽은 이전 노드의 멤버쉽과 다를 수 있습니다.

+
https://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-nmg/GUID-8929FCE2-5888-4051-B8C0-E27CAF3F2A63.html["VLAN을 생성하는 중입니다"]

+
https://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-nmg/GUID-DBC9DEE2-EAB7-430A-A773-4E3420EE2AA1.html["물리적 포트를 결합하여 인터페이스 그룹을 생성합니다"]







=== LIF 구성 확인 및 복원

업그레이드 절차를 시작할 때 LIF가 적절한 노드 및 포트에 매핑되어 있는지 확인합니다.

.이 문제에 대해서
* 이 작업은 site_B에서 수행됩니다
* 에서 생성한 포트 매핑 계획을 참조하십시오 link:task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html["이전 노드에서 새 노드로 포트 매핑"].


.단계
. 스위치백 이전에 해당 노드 및 포트에서 LIF가 호스팅되었는지 확인합니다.
+
.. 고급 권한 레벨로 변경:
+
세트 프리빌리지 고급

.. 포트 구성을 재정의하여 적절한 LIF 배치가 이루어지도록 합니다.
+
'vserver config override -command' network interface modify -vserver_vserver_name_-home-port_active_port_after_upgrade_-lif_lif_name_-home-node_new_node_name_'

+
'vserver config override' 명령 내에서 network interface modify 명령을 입력할 때는 tab autotcomplete 기능을 사용할 수 없습니다. 자동 완성 기능을 사용하여 네트워크 'interface modify'를 만든 다음 'vserver config override' 명령에 포함할 수 있습니다.

.. 관리자 권한 레벨로 돌아갑니다.
+
'Set-Privilege admin'입니다



. 인터페이스를 홈 노드로 되돌리기:
+
'네트워크 인터페이스 되돌리기 * - vserver_vserver-name_'

+
필요에 따라 모든 SVM에서 이 단계를 수행합니다.





== MetroCluster 구성을 다시 전환합니다

이 작업에서는 스위치백 작업을 수행하고 MetroCluster 구성을 정상 작동으로 되돌립니다. site_a의 노드가 아직 업그레이드를 기다리고 있습니다.

image::../media/mcc_upgrade_cluster_a_switchback.png[MCC 업그레이드 클러스터 A 스위치백]

.단계
. site_B에서 'MetroCluster node show' 명령어를 실행하여 출력을 확인한다.
+
.. 새 노드가 올바르게 표시되는지 확인합니다.
.. 새 노드가 "스위치백 대기 중" 상태에 있는지 확인합니다.


. 액티브 클러스터의 모든 노드에서 필수 명령을 실행하여 복구 및 스위치백을 수행합니다(업그레이드를 받지 않는 클러스터).
+
.. 데이터 애그리게이트 수정: + 'MetroCluster 환원 Aggregate
.. 루트 애그리게이트 수정:
+
MetroCluster 환원 루트

.. 클러스터 스위치백:
+
MetroCluster 스위치백



. 스위치백 작업의 진행률을 확인합니다.
+
MetroCluster 쇼

+
출력물에 '대기 중-스위치백'이 표시되면 스위치백 작업이 진행 중입니다.

+
[listing]
----
cluster_B::> metrocluster show
Cluster                   Entry Name          State
------------------------- ------------------- -----------
 Local: cluster_B         Configuration state configured
                          Mode                switchover
                          AUSO Failure Domain -
Remote: cluster_A         Configuration state configured
                          Mode                waiting-for-switchback
                          AUSO Failure Domain -
----
+
출력이 정상(Normal)으로 표시되면 스위치백 작업이 완료된 것입니다.

+
[listing]
----
cluster_B::> metrocluster show
Cluster                   Entry Name          State
------------------------- ------------------- -----------
 Local: cluster_B         Configuration state configured
                          Mode                normal
                          AUSO Failure Domain -
Remote: cluster_A         Configuration state configured
                          Mode                normal
                          AUSO Failure Domain -
----
+
스위치백을 완료하는 데 시간이 오래 걸리는 경우 'MetroCluster config-replication resync resync-status show' 명령을 사용하여 진행 중인 기준선의 상태를 확인할 수 있습니다. 이 명령은 고급 권한 수준에 있습니다.





== MetroCluster 구성 상태 점검

컨트롤러 모듈을 업그레이드한 후 MetroCluster 구성 상태를 확인해야 합니다.

이 작업은 MetroCluster 구성의 모든 노드에서 수행할 수 있습니다.

.단계
. MetroCluster 구성 작동을 확인합니다.
+
.. MetroCluster 설정을 확인하고 운영 모드가 정상인지 확인합니다. + 'MetroCluster show'
.. MetroCluster check 수행: + 'MetroCluster check run
.. MetroCluster 검사 결과를 표시합니다.
+
MetroCluster 체크 쇼



. MetroCluster 접속 상태와 상태를 확인합니다.
+
.. MetroCluster IP 연결을 확인합니다.
+
'Storage iSCSI-initiator show'를 선택합니다

.. 노드가 작동 중인지 확인합니다.
+
'MetroCluster node show'

.. MetroCluster IP 인터페이스가 작동하는지 확인합니다.
+
'MetroCluster configuration-settings interface show'를 선택합니다

.. 로컬 페일오버가 설정되었는지 확인합니다.
+
'스토리지 페일오버 쇼'







== cluster_a의 노드 업그레이드

cluster_A에서 업그레이드 작업을 반복해야 합니다

.단계
. 단계를 반복하여 cluster_A의 노드를 부터 업그레이드합니다 link:task_upgrade_controllers_in_a_four_node_ip_mcc_us_switchover_and_switchback_mcc_ip.html["업그레이드를 준비하는 중입니다"].
+
작업을 수행할 때 클러스터 및 노드에 대한 모든 예제 참조는 반전됩니다. 예를 들어, cluster_A에서 스위치오버로 예제를 제공할 경우 cluster_B에서 스위치오버합니다





== Tiebreaker 또는 중재자 모니터링 복원

MetroCluster 구성 업그레이드를 완료한 후 Tiebreaker 또는 중재자 유틸리티를 사용하여 모니터링을 재개할 수 있습니다.

.단계
. 필요한 경우 구성 절차를 사용하여 모니터링을 복원합니다.
+
|===
| 사용 중인 경우... | 이 절차를 사용합니다 


 a| 
Tiebreaker입니다
 a| 
link:../tiebreaker/concept_configuring_the_tiebreaker_software.html#adding-metrocluster-configurations["MetroCluster 구성 추가"].



 a| 
중재자
 a| 
link:../install-ip/concept_configure_the_ontap_mediator_for_unplanned_automatic_switchover.html["MetroCluster IP 구성에서 ONTAP 중재자 서비스 구성"].



 a| 
타사 응용 프로그램
 a| 
제품 설명서를 참조하십시오.

|===




== 유지 관리 후 사용자 지정 AutoSupport 메시지 보내기

업그레이드를 완료한 후에는 유지 보수 종료를 알리는 AutoSupport 메시지를 보내야 자동 케이스 생성이 재개됩니다.

.단계
. 자동 지원 케이스 생성을 재개하려면 유지 관리가 완료되었음을 나타내는 AutoSupport 메시지를 보냅니다.
+
.. 'system node AutoSupport invoke -node * -type all-message maINT=end' 명령을 실행합니다
.. 파트너 클러스터에서 명령을 반복합니다.



